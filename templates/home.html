{% include 'head.html' %}

{% include 'menu.html' %}

<div data-minval="{{ minVal }}" data-maxval="{{ maxVal }}" data-midval="{{ midVal }}" data-step="{{ step }}"</div>

{% block head %}

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script type=text/javascript>
  var minVal = $( "div" ).data("minval");
  var maxVal = $( "div" ).data("maxval");
  var midVal = $( "div" ).data("midval");
  var step = $( "div" ).data("step");
  this.$row_append = $([
      "<div class='input-group'>",
      "<select style='width:20%'>",
      "<option value='ge'>&ge;</option>",
      "<option value='le'>&le;</option>",
      "<option value='eq'>&equals;</option>",
      "</select>",
      "<span id='slider_value' class='form-control' style='width:20%'>'" + midVal + "' </span><br>",
      "<label for='regionIDs'></label><input type='range' min=${minVal} max=${maxVal} value=${midVal} class='slider' id='myRange' style='width:75px' step=${step} oninput='show_value(this.value);'>",
      "<a href='#' id='addrule'><button type='button' class='btn btn-secondary'>Add rule</button></a>",
      "</div>"
  ].join("\n"))
  function append_filter() {
      $( ".row" ).append( $row_append );
      return false;
    }
  $(function() {
    // The function is triggered on page load and with the "a#show_summary" button
    $('a#addrule').bind('click', append_filter);
  });
</script>
{% endblock %}

<div class="container">

<div id="queryTypes">

<h1>Select query mode</h1>

  <button class="btn btn-primary" type="button small" data-toggle="collapse" data-target="#retrieveSegments" aria-expanded="false" aria-controls="retrieveSegments">Retrieve segments</button>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#segfilt" aria-expanded="true" aria-controls="segfilt">Segmentation filter</button>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#segmentation-match" aria-expanded="true" aria-controls="segmentation-match">Segmentation match</button>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#query-annotations" aria-expanded="true" aria-controls="query-annotations">Query annotations</button>

  <div class="accordion-group">

  {% if show_regions %}
  <div class="collapse col-sm-6 show" id="retrieveSegments" data-parent="#queryTypes">
  {% else %}
  <div class="collapse col-sm-6" id="retrieveSegments" data-parent="#queryTypes">
  {% endif %}
    <h2>Retrieve segments</h2>
    <p>Given chr, start and stop values, the hub returns any overlapping segments from all segmentation providers linked to this hub.</p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#retrieveSegmentsModal">
      Help
    </button>    
    <form method="POST" action="/get" class="from-inline">
    <div class="row">
	  <div class="form-group col-md-4">
        <label for="chrom">Chromosome:</label><input type="text" name="chrom" id="chrom" class="form-control" />
      </div>
      <div class="form-group col-md-4">
        <label for="startval">Start Value:</label><input type="text" name="start" id="startval" class="form-control" />
      </div>
      <div class="form-group col-md-4">
        <label for="stopval">Stop Value:</label><input type="text" name="stop" id="stopval" class="form-control" />
      </div>
      <button class="btn btn-primary btn-sm form-control">Search</button>
    </div>
    </form>
  </div>

  {% if show_segmentations %}
  <div class="collapse col-sm-6 show" id="segfilt" data-parent="#queryTypes">
  {% else %}
  <div class="collapse col-sm-6" id="segfilt" data-parent="#queryTypes">
  {% endif %}
    <h2>Segmentation filter</h2>
    <p>Starting with a Segmentation, filter to a biologically relevant subset of regions.</p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#segmentationFilterModal">
      Help
    </button>     
    <form method="POST" action="/segmentations">
      <div class="form-group">
        <!-- <label for="provider">Provider:</label> -->
        <p>Provider:</p>
          <select name="selected_provider" id="selected_provider" class="form-control" onchange="this.form.submit()">
            {% if providerUrl is defined %}
            <option value="{{providerUrl}}" selected>{{ providerUrl }}</option>
            {% else %}
            <option value="" selected> - Select a provider - </option>
            {% endif %}
            {% if (provider_res is defined) and provider_res %}
              {% for provider in provider_res %}
                <option value="{{ provider.url }}">{{ provider.name }}</option>
              {% endfor %}
            {% endif %}
          </select>
        <br>

        <!-- <label for="segmentations">Segmentations:</label> -->
        <p>Segmentations:</p>
          <select name="segmentation_name" id="segmentation_name" class="form-control" onchange="this.form.submit()">
            {% if segmName is defined %}
            <option value="{{segmName}}" selected>{{segmName}} </option>
            {% else %}
            <option value="" selected> - Select a segmentation - </option>
            {% endif %}
            {% if (segm is defined) and segm %}
              {% for s in segm.result %}
                <option value="{{providerUrl}}!{{s}}">{{ s }}</option>
              {% endfor %}
            {% endif %}
          </select>
        <br>

        <!-- <label for="experiments">Experiments:</label> -->
        <p>Experiments:</p>
          <select name="experiment_name" id="experiment_name" class="form-control" onchange="this.form.submit()">
            {% if expName is defined %}
              <option value="{{expName}}" selected>{{expName}} </option>
            {% else %}
              <option value="" selected> - Select an experiment - </option>
            {% endif %}
            {% if (exps is defined) and exps %}
              {% for s in exps.result %}
                <option value="{{providerUrl}}!{{segmName}}!{{s}}">{{ s }}</option>
              {% endfor %}
            {% endif %}
          </select>
        <br>


        <p>Experiment Rules:</p>
          <div id="slider-region">
            <select name="Filter" class="form-control" style="width:60%">
              <option value="ge">&ge;</option>
              <option value="le">&le;</option>
              <option value="eq">&equals;</option>
            </select>

            <span class="slider_value" class="form-control" id="slider1" style="width:20%">{{midVal}}</span><br>
            <label for="regionIDs"></label><input type="range" min="{{minVal}}" max="{{maxVal}}" value="{{midVal}}" class="slider" id="myRange" style="width:75px" step="{{step}}" name="slider1" oninput="show_value(this.name, this.value);">
          </div>
          <br>
          <a href='#' id="addrule"><button type="button" class="btn btn-secondary">Add rule</button></a>

      </div>


        <button class="btn btn-primary btn-sm form-control">Search</button>

        <script>
          // JQuery for Add Rule
          var count = 1;
          var this_name;
          $('#addrule').click(function(){
            count += 1;
            this_name = "slider" + count.toString();
            $('#slider-region').append(
              '<select name="Filter" class="form-control" style="width:60%"><option value="ge">&ge;</option><option value="le">&le;</option><option value="eq">&equals;</option></select>'
            ).append(
              '<span class="slider_value" class="form-control" id=' + this_name + ' style="width:20%">{{midVal}}</span><br>'
            ).append(
              '<label for="regionIDs"></label><input type="range" min="{{minVal}}" max="{{maxVal}}" value="{{midVal}}" class="slider" id="myRange" style="width:75px" step="{{step}}" name=' + this_name + ' oninput="show_value(this.name, this.value);">'
            );
          });
        </script>
      </div>
    </form>
  </div>


  <div class="collapse col-sm-6" id="segmentation-match" data-parent="#queryTypes">
    <h2>Segmentation match</h2>
    <p>Given a region set, choose the best matching Segmentation.</p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#segmentationMatchModal">
      Help
    </button>     
    <form method="POST" action="/get">
        <div class="custom-file">
          <input type="file" class="custom-file-input" id="customFile">
          <label class="custom-file-label" for="customFile">Choose file</label>
        </div>
        <button class="btn btn-primary btn-sm form-control" disabled>Search</button>
    </form>
  </div>


  <div class="collapse col-sm-6" id="query-annotations" data-parent="#queryTypes">
    <h2>Query annotations</h2>
    <p>Use a starting point and ending point for a search across records.</p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#queryAnnotationsModal">
      Help
    </button>     
    <form method="POST" action="/annotations">
      <div class="input-group">
        <label for="regionIDs">Region IDs:</label><input type="text" name="regionID" id="regionID" class="form-control"/>
        <button class="btn btn-primary btn-sm form-control">Search</button>
      </div>
    </form>
  </div>

</div>
</div>
</div>


<!-- Modals for detailed help instructions -->
<div class="modal fade" id="retrieveSegmentsModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Instructions for retrieving segments</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Given chr, start and stop values, the hub returns any overlapping segments from all segmentation providers linked to this hub.</p>

        <p>You can find more detailed explanation in the <a href="http://code.databio.org/episb/howto-query-provider/">episb query modes documentation</a>.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="segmentationFilterModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Instructions for segmentation filter</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>A segmentation is a collection of genomic regions that divides the genome into non-overlapping regions of interest. The segmentation filter allows a user to take a given segmentation and filter it using custom criteria. You should use the segmentation filter to reduce a segmentation to a subset that is specific for a particular biological question.</p>

        <p>You can find more detailed explanation in the <a href="http://code.databio.org/episb/howto-query-provider/">episb query modes documentation</a>.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="segmentationMatchModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Instructions for segmentation match</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>The segmentation match query allows a user to upload a set of genomic regions (such as a BED file) and it will return the best segmentation for those regions. You should use the segmentation match to determine the best way to normalize your region set to an existing segmentation, so that you can better integrate with existing data resources.</p>

        <p>You can find more detailed explanation in the <a href="http://code.databio.org/episb/howto-query-provider/">episb query modes documentation</a>.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="queryAnnotationsModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Instructions for annotation query</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>The annotation query allows a user to identify all experimental annotations for a given segment. This query is useful to provide all information in the database about a particular locus. You should use this query when you are investigating a particular gene or regulatory element and want to know about all available experimental data that covers your region of interest.</p>

        <p>You can find more detailed explanation in the <a href="http://code.databio.org/episb/howto-query-provider/">episb query modes documentation</a>.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% include 'foot.html' %}
